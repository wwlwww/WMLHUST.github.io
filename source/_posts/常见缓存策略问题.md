---
title: 常见缓存策略问题
tags: []
categories: []
comments: true
date: 2020-08-20 16:19:28
updated: 2020-08-20 16:19:28
description:
---

## 一、缓存穿透：
缓存穿透指，请求的key不在缓存中，因此会透过缓存，去请求DB或上游服务。具体可分三种情况：
1. key有效，value不为空，然而未缓存  
属于正常情况。

2. key有效，然而value为空，因此缓存未查到
为了避免重复访问，每次都穿透缓存，可以缓存一个约定好的无效值。读到该无效值即表示value为空，而无需访问DB。

3. key无效，缓存自然不存在
使用`布隆过滤器`或`位图`等，在处理请求前进行过滤，无效的key直接拒绝。当然需要预热，提前把有效的key放在`布隆过滤器`或`位图`里面。

## 二、缓存雪崩
缓存雪崩，是指大量的key-value同时失效，导致大量请求穿透去访问DB。为了避免这种情况：
- 设置key过期时间时，增加随机范围；
- 缓存节点故障，也可能导致该问题。可以增加从节点，及时替换。缓存集群的多节点，可以使用一致性hash，将失效节点的访问分散到不同的节点上，避免引起连锁故障。

## 三、缓存热点
缓存热点，指有个别热点key访问特别大，比如明星、大V等，对热点key的访问可能会导致个别缓存节点压力巨大。  
对于此类高并发读，可以设置多个副本，放置在不同的节点上，分摊压力。可以参考[高并发常见方案](https://acac.fun/2020/05/12/%E9%AB%98%E5%B9%B6%E5%8F%91/)。

## 其他
1. 还有一种情况是，大量请求，访问同一个key，而这个key刚好失效，DB会收到大量读取同一行数据的请求。这就要求，同一节点，对于访问同一key的重复请求，只访问一次DB，简单地加一个互斥锁即可（和golang的sync.Once非常像），使用redis分布式锁也可以。
2. **缓存最重要的是，减少DB的压力。对于数据的安全、一致性还是需要关系型数据库实现。**
3. 缓存本身也会面临各种各样的问题，包括性能、可用性等。读写性能可以参考[高并发常见方案](https://acac.fun/2020/05/12/%E9%AB%98%E5%B9%B6%E5%8F%91/)。可用性一般使用主从架构来实现，保证主机出问题，从机可以及时顶替上去。
